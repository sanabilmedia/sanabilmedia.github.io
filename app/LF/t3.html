<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âµ‰âµ™â´½â´½âµ‰âµâµ âµ âµœâ´¼âµ‰âµâ´°âµ–</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        /* Reset and Box-sizing */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #202124;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .quiz-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,.1);
            width: 100%;
            max-width: 600px;
            overflow: hidden;
            transition: min-height 0.3s ease-in-out;
        }

        .header {
            padding: 16px 24px; /* Adjusted padding */
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px; /* Add gap between elements */
        }

        .header .header-left { /* New container for photo and title */
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover; /* Ensures image covers the area */
            border: 1px solid #eee;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 500;
            color: #1a73e8;
            margin: 0; /* Remove default margin */
        }

        .header .player-name {
            font-size: 1rem;
            color: #5f6368;
            white-space: nowrap;
            text-align: right; /* Keep name aligned right */
            flex-shrink: 0; /* Prevent name from shrinking */
        }

        .quiz-content {
            padding: 24px;
        }

        .timer {
            font-size: 1rem;
            margin-bottom: 16px;
            color: #5f6368;
        }

        .progress {
            height: 4px;
            background-color: #e8f0fe;
            border-radius: 2px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #1a73e8;
            width: 0;
            transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
            border-radius: 2px;
        }

        .progress-bar.warning {
            background-color: #ffa000;
        }

        .question {
            font-size: 1.1rem;
            margin-bottom: 20px;
            line-height: 1.5;
            transform: scale(2);
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            width: fit-content;
        }

        .options {
            display: grid;
            gap: 10px;
            margin-top: 16px;
            text-align: center;
        }

        .option {
            background-color: #fff;
            border: 1px solid #dadce0;
            border-radius: 4px;
            padding: 12px 16px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            transform: scale(1);
            font-size: 1.5rem;
        }

        .option:hover {
            background-color: #f1f3f4;
        }

        .option.selected {
            background-color: #deebfd;
            border-color: #90caf9;
        }

        .option.correct {
            background-color: #e6f4ea;
            border-color: #81c784;
            color: #1b5e20;
        }

        .option.incorrect {
            background-color: #ffe0b2;
            border-color: #ffb300;
            color: #bf360c;
        }

       .name-input-screen {
            text-align: center;
            padding: 32px;
        }

        .name-input-screen h1 {
            margin-bottom: 24px;
            font-size: 1.8rem;
            font-weight: 500;
            color: #1a73e8;
        }

        /* Style for photo preview on name screen */
        .name-input-screen #userPhotoPreview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #eee;
            display: none; /* Start hidden */
            margin-left: auto; /* Center */
            margin-right: auto; /* Center */
            margin-bottom: 16px;
        }

        .name-input-screen select {
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 16px;
            width: 100%;
            outline: none;
        }
        .name-input-screen select:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 1px #1a73e8;
        }

        .name-input-screen button,
        .restart-btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s ease;
            text-transform: none;
            letter-spacing: normal;
            font-weight: 500;
            outline: none;
        }

        .name-input-screen button:hover,
        .restart-btn:hover {
            background-color: #155bb3;
        }

        .name-input-screen button:disabled {
            background-color: #e0e0e0;
            color: #9e9e9e;
            cursor: not-allowed;
        }

        .result-screen {
            padding: 24px;
            text-align: center;
        }

        /* Style for photo on results screen (CENTERED ONE) */
        .result-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 16px;
            border: 3px solid #1a73e8; /* Match theme color */
            display: block; /* Center the block element */
            margin-left: auto;
            margin-right: auto;
        }

        .result-screen h2 {
            margin-bottom: 10px; /* Reduced margin */
            font-size: 1.5rem;
            color: #202124; /* Darker color for name */
        }
         .result-screen h2:first-of-type { /* Style for the name */
             margin-top: 0; /* Remove potential top margin if needed */
         }

        .result-screen h2.performance-rating { /* Specific class for rating */
            margin-bottom: 20px;
            font-size: 1.3rem; /* Slightly smaller */
            color: #1a73e8; /* Blue color */
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .result-item {
            background-color: #f9f9f9;
            padding: 16px;
            border-radius: 4px;
            border: 1px solid #eee;
        }

        .result-item span {
            display: block;
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 4px;
            color: #202124;
        }

        .result-item .label {
            font-size: 0.9rem;
            color: #757575;
        }

        .question-review {
            margin-top: 24px;
            text-align: left;
        }

        .question-review-item {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 4px;
            background-color: #fff;
            border: 1px solid #eee;
        }

        .question-review-item h4 {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .question-review-item.correct {
            border-left: 4px solid #4caf50;
        }

        .question-review-item.correct h4 {
            color: #4caf50;
        }

        .question-review-item.incorrect {
            border-left: 4px solid #f44336;
        }

        .question-review-item.incorrect h4 {
            color: #f44336;
        }

        .question-review-item p {
            margin: 4px 0;
            color: #5f6368;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .quiz-container {
                margin: 10px;
            }

            .header h1 {
                font-size: 1.3rem;
            }
            .header-photo {
                width: 35px;
                height: 35px;
            }
             .header .player-name {
                font-size: 0.9rem;
            }

            .question {
                font-size: 1rem;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
             .result-photo {
                width: 80px;
                height: 80px;
             }
        }
    </style>
</head>
<body>
    <div class="quiz-container" id="quizApp">
        <!-- Quiz content will be dynamically inserted here -->
    </div>

    <script>
        const QUIZ_QUESTIONS = [
   {
       question: "âµœâ´°â´·â´·â´°â´³âµœ",
       options: ["ØªÙØ¯ÙÙ„Ù", "Ø£ÙÙˆÙ’ØªÙÙ„Ù’", "ØªÙÙ‡ÙØ±ÙØªÙ’", "ØªÙØ¯ÙÙ‘İ£Ù’ØªÙ’"],
       correctAnswer: "ØªÙØ¯ÙÙ‘İ£Ù’ØªÙ’"
   },
   {
       question: "â´°âµ¡âµœâµ‰âµ",
       options: ["ØªÙØ®Ù’Ø³Ù", "Ø£ÙÙˆÙ’ØªÙÙ„Ù’", "Ø£ÙÙ‚ÙÙ‘Ø±ÙØ¶Ù’", "Ø£ÙÙƒÙ’Ø±ÙÙ‘Ø¬Ù’"],
       correctAnswer: "Ø£ÙÙˆÙ’ØªÙÙ„Ù’"
   },
   {
       question: "âµœâµ‰âµ€âµ‰âµ”âµ‰âµœ",
       options: ["Ø£ÙÙ…ÙÙ„Ù", "ØªÙØ¯ÙÙ„Ù", "ØªÙÙ‡ÙØ±ÙØªÙ’", "Ø£ÙØ³ÙÙÙØ±Ù’"],
       correctAnswer: "ØªÙÙ‡ÙØ±ÙØªÙ’"
   },
   {
       question: "â´°âµ¡âµ™âµ™â´°âµ”",
       options: ["Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’", "Ø£ÙØºÙ’Ø±ÙØ¨Ù’", "Ø£ÙØ´Ù’ÙˆÙÙ‘Ù„Ù’", "ØªÙØ²ÙØ±Ù"],
       correctAnswer: "Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’"
   },
   {
       question: "âµœâµ‰âµ…âµ™âµ‰",
       options: ["Ø£Ùİ£Ù’ÙˆÙ’Ø¶Ù", "ØªÙØ®Ù’Ø³Ù", "Ø£ÙÙƒÙ’ÙˆÙ’ÙÙÙŠÙ’", "ØªÙÙ…Ù‘Ù’Ù…Ù’ØªÙ’"],
       correctAnswer: "ØªÙØ®Ù’Ø³Ù"
   },
   {
       question: "â´°âµ‡âµ‡â´°âµ”âµ‰â´°â´¹",
       options: ["Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’", "Ø¥ÙØºÙØ±Ù’Ø¶Ù’Ù…Ù’", "Ø£ÙØ­Ù’Ø¬ÙÙ‘Ù…Ù’", "Ø£ÙÙ‚ÙÙ‘Ø±ÙØ¶Ù’"],
       correctAnswer: "Ø£ÙÙ‚ÙÙ‘Ø±ÙØ¶Ù’"
   },
   {
       question: "â´°â´½âµ•âµ•â´°âµŠ",
       options: ["Ø£ÙØ²ÙÙˆÙÙ†Ù’", "Ø£ÙÙƒÙ’Ø±ÙÙ‘Ø¬Ù’", "ØªÙØ¯ÙÙ‘İ£Ù’ØªÙ’", "Ø£ÙÙˆÙ’ØªÙÙ„Ù’"],
       correctAnswer: "Ø£ÙÙƒÙ’Ø±ÙÙ‘Ø¬Ù’"
   },
   {
       question: "â´°âµâ´°âµâµ“",
       options: ["Ø£ÙØ³ÙÙÙØ±Ù’", "ØªÙÙ‡ÙØ±ÙØªÙ’", "Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’", "Ø£ÙÙ…ÙÙ„Ù"],
       correctAnswer: "Ø£ÙÙ…ÙÙ„Ù"
   },
   {
       question: "âµœâ´°â´·â´°âµâ´°",
       options: ["Ø£ÙÙ‚ÙÙ‘Ø±ÙØ¶Ù’", "ØªÙØ¯ÙÙ„Ù", "Ø£ÙÙƒÙ’Ø±ÙÙ‘Ø¬Ù’", "Ø£ÙØ³ÙÙÙØ±Ù’"],
       correctAnswer: "ØªÙØ¯ÙÙ„Ù"
   },
   {
       question: "â´°âµ™â´°â´¼â´°âµ”",
       options: ["Ø£ÙØºÙ’Ø±ÙØ¨Ù’", "Ø£ÙØ³ÙÙÙØ±Ù’", "Ø£ÙØ´Ù’ÙˆÙÙ‘Ù„Ù’", "ØªÙØ²ÙØ±Ù"],
       correctAnswer: "Ø£ÙØ³ÙÙÙØ±Ù’"
   },
   {
       question: "â´°âµ–âµ”â´°â´±",
       options: ["Ø£Ùİ£Ù’ÙˆÙ’Ø¶Ù", "Ø£ÙÙƒÙ’ÙˆÙ’ÙÙÙŠÙ’", "Ø£ÙØºÙ’Ø±ÙØ¨Ù’", "ØªÙÙ…Ù‘Ù’Ù…Ù’ØªÙ’"],
       correctAnswer: "Ø£ÙØºÙ’Ø±ÙØ¨Ù’"
   },
   {
       question: "â´°âµ›âµ¡âµ¡â´°âµ",
       options: ["Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’", "Ø¥ÙØºÙØ±Ù’Ø¶Ù’Ù…Ù’", "Ø£ÙØ­Ù’Ø¬ÙÙ‘Ù…Ù’", "Ø£ÙØ´Ù’ÙˆÙÙ‘Ù„Ù’"],
       correctAnswer: "Ø£ÙØ´Ù’ÙˆÙÙ‘Ù„Ù’"
   },
   {
       question: "âµœâ´°âµ£âµ‰âµ”âµ‰",
       options: ["Ø£ÙØ²ÙÙˆÙÙ†Ù’", "ØªÙØ²ÙØ±Ù", "ØªÙØ¯ÙÙ‘İ£Ù’ØªÙ’", "Ø£ÙÙˆÙ’ØªÙÙ„Ù’"],
       correctAnswer: "ØªÙØ²ÙØ±Ù"
   },
   {
       question: "â´°â´³âµ¯â´¹âµ‰",
       options: ["ØªÙÙ‡ÙØ±ÙØªÙ’", "Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’", "Ø£Ùİ£Ù’ÙˆÙ’Ø¶Ù", "ØªÙØ®Ù’Ø³Ù"],
       correctAnswer: "Ø£Ùİ£Ù’ÙˆÙ’Ø¶Ù"
   },
   {
       question: "â´°â´½âµ¯â´¼â´°âµ¢",
       options: ["Ø£ÙÙ‚ÙÙ‘Ø±ÙØ¶Ù’", "Ø£ÙÙƒÙ’Ø±ÙÙ‘Ø¬Ù’", "Ø£ÙÙƒÙ’ÙˆÙ’ÙÙÙŠÙ’", "Ø£ÙÙ…ÙÙ„Ù"],
       correctAnswer: "Ø£ÙÙƒÙ’ÙˆÙ’ÙÙÙŠÙ’"
   },
   {
       question: "âµœâ´°âµâµâ´»âµâµœ",
       options: ["ØªÙØ¯ÙÙ„Ù", "Ø£ÙØ³ÙÙÙØ±Ù’", "ØªÙÙ…Ù‘Ù’Ù…Ù’ØªÙ’", "Ø£ÙØºÙ’Ø±ÙØ¨Ù’"],
       correctAnswer: "ØªÙÙ…Ù‘Ù’Ù…Ù’ØªÙ’"
   },
   {
       question: "âµ‰âµ–âµ‰âµ•â´¹âµ",
       options: ["Ø£ÙØ´Ù’ÙˆÙÙ‘Ù„Ù’", "ØªÙØ²ÙØ±Ù", "Ø¥ÙØºÙØ±Ù’Ø¶Ù’Ù…Ù’", "Ø£Ùİ£Ù’ÙˆÙ’Ø¶Ù"],
       correctAnswer: "Ø¥ÙØºÙØ±Ù’Ø¶Ù’Ù…Ù’"
   },
   {
       question: "â´°âµƒâµŠâµŠâ´°âµ",
       options: ["Ø£ÙÙƒÙ’ÙˆÙ’ÙÙÙŠÙ’", "Ø£ÙØ­Ù’Ø¬ÙÙ‘Ù…Ù’", "ØªÙÙ…Ù‘Ù’Ù…Ù’ØªÙ’", "Ø£ÙÙÙ’Ø±Ù’Ø·Ù’Ø·ÙÙ‘"],
       correctAnswer: "Ø£ÙØ­Ù’Ø¬ÙÙ‘Ù…Ù’"
   },
   {
       question: "â´°â´¼âµ•âµŸâ´»âµŸâµŸâµ“",
       options: ["Ø£ÙØ²ÙÙˆÙÙ†Ù’", "Ø¥ÙØºÙØ±Ù’Ø¶Ù’Ù…Ù’", "Ø£ÙÙÙ’Ø±Ù’Ø·Ù’Ø·ÙÙ‘", "ØªÙØ¯ÙÙ‘İ£Ù’ØªÙ’"],
       correctAnswer: "Ø£ÙÙÙ’Ø±Ù’Ø·Ù’Ø·ÙÙ‘"
   },
   {
       question: "â´°âµ¥â´°âµ¡â´°âµ",
       options: ["Ø£ÙÙˆÙ’ØªÙÙ„Ù’", "ØªÙÙ‡ÙØ±ÙØªÙ’", "Ø£ÙØ²ÙÙˆÙÙ†Ù’", "Ø£ÙÙˆÙ’Ø³ÙÙ‘Ø±Ù’"],
       correctAnswer: "Ø£ÙØ²ÙÙˆÙÙ†Ù’"
   }
];

        const PHOTO_PATH = ""; // Define the path to your photos folder (e.g., "photos/")

        class GeneralKnowledgeQuiz {
            constructor() {
                this.questions = QUIZ_QUESTIONS;
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.timeLimit = 15;
                this.timer = null;
                this.selectedAnswer = null;
                this.summaryData = [];
                this.playerName = '';
                this.selectedUserData = null;
                this.quizApp = document.getElementById('quizApp');
                this.startTime = null;
                this.initialQuizContainerHeight = null;
                this.users = [
                    { name: "1_G3_Ø­Ø¬ÙˆØ¨ÙŠ Ø£Ø­Ù„Ø§Ù…", photo: "G3_1.jpg" },
                    { name: "2_G3_Ø§Ø¯Ù„ÙŠØ²Ø© Ø®Ø¯ÙŠØ¬Ø©", photo: "G3_2.jpg" },
                    { name: "3_G3_Ø¨ÙˆØ±Ø¨ÙŠØ¹ Ù„ÙŠÙ„Ù‰", photo: "G3_3.jpg" },
                    { name: "4_G3_Ù…Ø²ÙŠÙ„ ÙŠÙˆØ³Ù", photo: "G3_4.jpg" },
                    { name: "5_G3_Ø§Ù„Ù…Ø­Ø¨ Ø§Ù„ÙŠØ§Ø³", photo: "G3_5.jpg" },
                    { name: "6_G3_Ø¨ÙŠØ³Ù‰ Ù…Ø±ÙŠÙ…", photo: "G3_6.jpg" },
                    { name: "7_G3_Ø¨ÙˆÙØ¶ÙŠÙ„ Ø¹ØµØ§Ù…", photo: "G3_7.jpg" },
                    { name: "8_G3_Ø´Ø¹Ø±Ø© Ø§ÙŠÙˆØ¨", photo: "G3_8.jpg" },
                    { name: "9_G3_Ø­Ø¨Ø± Ø³Ø¹Ø¯ Ø§Ù„Ø¯ÙŠÙ†", photo: "G3_9.jpg" },
                    { name: "10_G3_ÙˆØ¹Ù„ÙŠ Ø¬Ù†Ø§Ù†", photo: "G3_10.jpg" },
                    { name: "11_G3_Ø§Ù„Ø¨Ø³ÙˆØ· Ù…Ù„Ø§Ùƒ", photo: "G3_11.jpg" },
                    { name: "12_G3_Ø§Ù„Ø¯Ø±ÙˆÙŠØ´ Ø¬Ù†Ø§Øª", photo: "G3_12.jpg" },
                    { name: "13_G3_Ø§Ø±Ø­Ø§Ù„ÙŠ ÙŠÙˆØ³Ù", photo: "G3_13.jpg" },
                    { name: "14_G3_Ø¯Ù‡ÙŠÙ… Ù‡Ø¨Ø©", photo: "G3_14.jpg" },
                    { name: "15_G3_Ø¨ÙˆÙƒØ§Ø± Ø£Ù…ÙŠØ±Ø©", photo: "G3_15.jpg" },
                    { name: "16_G3_Ø§Ù…Ø²ÙŠÙ„ ÙØ§Ø·Ù…Ø©", photo: "G3_16.jpg" },
                    { name: "17_G3_Ø§Ù„Ù…Ø¯Ø¬ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù…", photo: "G3_17.jpg" },
                    { name: "18_G3_Ø¨ÙˆØ±Ø­ÙŠÙ… Ø¥ÙƒØ±Ø§Ù…", photo: "G3_18.jpg" },
                    { name: "19_G3_Ù…Ø±Ø²ÙˆÙƒÙŠ Ø¥Ø­Ø³Ø§Ù†", photo: "G3_19.jpg" },
                    { name: "20_G3_Ø§Ù„Ø¹Ù„ÙˆÙŠ ØµÙØ§Ø¡", photo: "G3_20.jpg" },
                    { name: "21_G3_Ù„Ø²Ø±Ùƒ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…", photo: "G3_21.jpg" },
                    { name: "22_G3_Ø¹Ù„ÙŠÙˆÙŠØ´ Ù…ØµØ¹Ø¨", photo: "G3_22.jpg" },
                    { name: "23_G3_Ø¯Ø­Ø§Ù† Ø¢ÙŠØ©", photo: "G3_23.jpg" },
                    { name: "24_G3_Ø§Ù„ÙŠØ²ÙŠØ¯ÙŠ Ø¥ÙŠÙ…Ø§Ù†", photo: "G3_24.jpg" },
                    { name: "25_G3_Ø¨ÙˆØ±Ø´ÙˆÙ‚ Ø§Ø¯Ù…", photo: "G3_25.jpg" },
                    { name: "26_G3_Ø¨Ø¶Ø§Ø± Ù…Ø­Ù…Ø¯", photo: "G3_26.jpg" },
                    { name: "27_G3_Ø²Ù…Ø§Ù†ÙŠ Ù…Ø¹Ø§Ø¯", photo: "G3_27.jpg" },
                    { name: "28_G3_Ø¨ÙˆÙƒØ±Ùˆ Ù…Ø­Ù…Ø¯", photo: "G3_28.jpg" },
                    { name: "29_G3_Ø§Ù„Ø¹Ù…Ù„ Ù„Ù…ÙŠØ§Ø¡", photo: "G3_29.jpg" },
                    { name: "30_G3_Ø§Ù„ØºØ²Ø§Ù„ÙŠ Ø¹Ù…Ø±Ø§Ù†", photo: "G3_30.jpg" },
                    { name: "31_G3_ØªÙƒÙ†ÙŠ Ø­ÙØµØ©", photo: "G3_31.jpg" },
                    { name: "32_G3_Ø§Ù„Ø·Ø§Ù‡Ø±ÙŠ ÙØ±Ø­Ø§Ù†", photo: "G3_32.jpg" },
                    { name: "33_G3_Ø²ÙˆÙŠÙ‚ÙŠØ± Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ø§Ù†", photo: "G3_33.jpg" },
                    { name: "34_G3_Ø¨Ù† Ù…Ø§Ù„Ùƒ Ø¨Ø³Ù…Ø©", photo: "G3_34.jpg" }
                ];
                this.renderNameInputScreen();
            }

            renderNameInputScreen() {
                this.quizApp.innerHTML = `
                    <div class="name-input-screen">
                        <h1>âµ‰âµ™â´½â´½âµ‰âµâµ âµ âµœâ´¼âµ‰âµâ´°âµ–</h1>
                        <!-- Image preview element (starts hidden via CSS) -->
                        <img id="userPhotoPreview" src="" alt="User Photo">
                        <select id="userSelect">
                            <option value="" disabled selected>â´°âµ”â´° â´°âµ™âµ™â´°âµ– âµâ´½</option>
                            ${this.users.map(user => `<option value="${user.name}">${user.name}</option>`).join('')}
                        </select>
                        <button id="startQuizBtn" disabled>âµ™âµ™âµâµœâµ‰</button>
                    </div>
                `;

                const userSelect = document.getElementById('userSelect');
                const startButton = document.getElementById('startQuizBtn');
                const photoPreview = document.getElementById('userPhotoPreview');

                userSelect.addEventListener('change', () => {
                    const selectedUserName = userSelect.value;
                    this.selectedUserData = this.users.find(user => user.name === selectedUserName);

                    if (this.selectedUserData) {
                        this.playerName = this.selectedUserData.name;
                        // Set photo src and make it visible
                        photoPreview.src = PHOTO_PATH + this.selectedUserData.photo;
                        photoPreview.style.display = 'block'; // <-- SHOW PHOTO HERE
                        startButton.disabled = false;
                    } else {
                        this.playerName = '';
                        this.selectedUserData = null;
                        // Clear photo src and hide it
                        photoPreview.src = '';
                        photoPreview.style.display = 'none'; // <-- HIDE PHOTO HERE
                        startButton.disabled = true;
                    }
                });

                startButton.addEventListener('click', () => {
                    if (this.playerName && this.selectedUserData) {
                        this.initQuiz();
                    }
                });
            }

            initQuiz() {
                this.renderQuizScreen();
                this.startTimer();
            }

            startTimer() {
                 let timeLeft = this.timeLimit;
                const timerElement = document.getElementById('time');
                const progressBar = document.querySelector('.progress-bar');
                this.startTime = Date.now();

                if (this.timer) {
                    clearInterval(this.timer);
                }

                this.timer = setInterval(() => {
                    timeLeft--;
                    if(timerElement) timerElement.textContent = `${timeLeft}s`;
                    if(progressBar) progressBar.style.width = `${(timeLeft / this.timeLimit) * 100}%`;

                    if (timeLeft <= 5 && progressBar) {
                        progressBar.classList.add('warning');
                    } else if (progressBar) {
                        progressBar.classList.remove('warning');
                    }

                    if (timeLeft === 12) {
                        this.showOptions();
                        this.captureInitialHeight();
                    }

                    if (timeLeft <= 0) {
                        this.handleTimeOut();
                    }
                }, 1000);
            }
            captureInitialHeight() {
                if (this.initialQuizContainerHeight === null) {
                    this.initialQuizContainerHeight = this.quizApp.offsetHeight;
                    this.quizApp.style.minHeight = `${this.initialQuizContainerHeight}px`;
                }
            }
             showOptions() {
                const optionsContainer = document.querySelector('.options');
                if (optionsContainer) {
                    optionsContainer.classList.remove('hidden');
                }
            }

            renderQuizScreen() {
                const currentQuestion = this.questions[this.currentQuestionIndex];
                // Photo is included in the header during the quiz
                const photoSrc = this.selectedUserData ? PHOTO_PATH + this.selectedUserData.photo : '';
                this.quizApp.innerHTML = `
                    <div class="header">
                        <div class="header-left">
                            <img src="${photoSrc}" alt="User" class="header-photo">
                             <h1>${this.currentQuestionIndex + 1})</h1>
                        </div>
                        <span class="player-name">${this.playerName}</span>
                    </div>
                    <div class="quiz-content">
                        <div class="timer"><span id="time">${this.timeLimit}s</span></div>
                        <div class="progress">
                            <div class="progress-bar" style="width: 100%;"></div>
                        </div>
                        <div class="question">
                            ${currentQuestion.question}
                        </div>
                         <div class="options hidden">
                            ${currentQuestion.options.map(option => `
                                <div class="option" data-option="${option}">
                                    ${option}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                this.attachOptionListeners();
                if (this.initialQuizContainerHeight !== null) {
                    this.quizApp.style.minHeight = `${this.initialQuizContainerHeight}px`;
                }
            }


            attachOptionListeners() {
                const options = document.querySelectorAll('.option');
                options.forEach(option => {
                    option.addEventListener('click', () => {
                        if (this.selectedAnswer) return;
                        this.selectedAnswer = option.getAttribute('data-option');
                        this.checkAnswer(option);
                    });
                });
            }

           checkAnswer(selectedOption) {
                clearInterval(this.timer);
                const currentQuestion = this.questions[this.currentQuestionIndex];
                const correctOption = document.querySelector(
                    `.option[data-option="${currentQuestion.correctAnswer}"]`
                );
                const endTime = Date.now();
                const timeSpent = ((endTime - this.startTime) / 1000).toFixed(1);
                this.questions[this.currentQuestionIndex].timeSpent = Math.max(0, Math.min(this.timeLimit, timeSpent));


                 document.querySelectorAll('.option').forEach(opt => opt.style.pointerEvents = 'none');

                if (this.selectedAnswer === currentQuestion.correctAnswer) {
                    selectedOption.classList.add('correct');
                    this.score++;
                    this.questions[this.currentQuestionIndex].userAnswer = this.selectedAnswer;
                     this.questions[this.currentQuestionIndex].result = "Oui";
                } else {
                    selectedOption.classList.add('incorrect');
                    if(correctOption) correctOption.classList.add('correct');
                    this.questions[this.currentQuestionIndex].userAnswer = this.selectedAnswer;
                    this.questions[this.currentQuestionIndex].result = "Non";
                }

                setTimeout(() => this.nextQuestion(), 1500);
            }

            handleTimeOut() {
                clearInterval(this.timer);
                const currentQuestion = this.questions[this.currentQuestionIndex];
                const correctOption = document.querySelector(
                    `.option[data-option="${currentQuestion.correctAnswer}"]`
                );

                 this.showOptions();
                 document.querySelectorAll('.option').forEach(opt => opt.style.pointerEvents = 'none');

                this.questions[this.currentQuestionIndex].timeSpent = this.timeLimit.toFixed(1);
                this.questions[this.currentQuestionIndex].userAnswer = "âµ‰âµ™âµ™âµâ´· âµ¡â´°â´½âµ“â´·";
                this.questions[this.currentQuestionIndex].result = "Non";

                if(correctOption) correctOption.classList.add('correct');

                setTimeout(() => this.nextQuestion(), 1500);
            }

            nextQuestion() {
                this.currentQuestionIndex++;
                this.selectedAnswer = null;
                 this.startTime = null;

                if (this.currentQuestionIndex < this.questions.length) {
                    this.renderQuizScreen();
                     this.startTimer();
                } else {
                    this.showResult();
                }
            }
            calculatePerformanceRating(score) {
                const percentage = (score / this.questions.length) * 100;
                if (percentage === 100) return 'ğŸ† Ù…Ù…ØªØ§Ø²';
                if (percentage >= 80) return 'Ø£Ø­Ø³Ù†Øª';
                if (percentage >= 60) return 'Ù…ØªÙˆØ³Ø·';
                if (percentage >= 40) return 'ØªÙ…Ø±Ù† Ø¬ÙŠØ¯Ø§';
                return 'Ù†ØªÙŠØ¬Ø© Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§';
            }

            showResult() {
                 this.questions.forEach(q => {
                    if (q.timeSpent === undefined) {
                        console.warn(`Question "${q.question}" missing timeSpent. Setting to 0.`);
                        q.timeSpent = "0.0";
                    }
                 });
                 const totalTime = this.questions.reduce((sum, q) => sum + parseFloat(q.timeSpent || 0), 0);
                 const avgTime = this.questions.length > 0 ? (totalTime / this.questions.length).toFixed(1) : "0.0";
                const percentage = ((this.score / this.questions.length) * 100).toFixed(1);

                const correctAnswers = this.questions.filter(q => q.result === 'Oui');
                const totalTimeCorrect = correctAnswers.reduce((sum, q) => sum + parseFloat(q.timeSpent || 0), 0);
                const avgTimeCorrect = correctAnswers.length > 0 ? (totalTimeCorrect / correctAnswers.length).toFixed(1) : "0.0";

                this.summaryData = this.questions.map((q, i) => ({
                    Question: q.question,
                    YourAnswer: q.userAnswer || "âµ“âµ” âµœâµ™âµ™âµâ´°âµ¡â´°",
                    CorrectAnswer: q.correctAnswer,
                    Result: q.result || "Non",
                    TimeSpent: q.timeSpent ? `${q.timeSpent}s` : "0s"
                }));

                 // --- MODIFICATION: Photo only included for the centered result photo ---
                 const photoSrc = this.selectedUserData ? PHOTO_PATH + this.selectedUserData.photo : '';
                this.quizApp.innerHTML = `
                    <div class="header">
                         <div class="header-left"> <!-- Header without the small photo -->
                             <h1>âµ‰âµ™â´½â´½âµ‰âµâµ</h1>
                         </div>
                          <span class="player-name">${this.playerName}</span> <!-- Keep name in header -->
                    </div>
                    <div class="result-screen">
                         <!-- ONLY the centered photo is shown here -->
                         <img src="${photoSrc}" alt="User Photo" class="result-photo">
                        <h2>${this.playerName}</h2>
                        <h2 class="performance-rating">${this.calculatePerformanceRating(this.score)}</h2>
                        <div class="result-grid">
                            <div class="result-item">
                                <span>${this.score}/${this.questions.length}</span>
                                <span class="label">â´°âµœâµ‰â´³</span>
                            </div>
                            <div class="result-item">
                                <span>${percentage}%</span>
                                <span class="label">âµœâµ‰â´³âµâµ‰â´¹âµ‰</span>
                            </div>
                             <div class="result-item">
                                <span>${avgTime}s</span>
                                <span class="label">â´°â´½âµ“â´·</span>
                            </div>
                             <div class="result-item">
                                <span>${avgTimeCorrect}s</span>
                                <span class="label">â´°â´½âµ“â´· âµ âµ‰âµâµ‰â´·âµ‰âµœâµ</span>
                            </div>
                        </div>
                        <h3>âµ‰â´¼âµ”âµ“âµ”âµ‰âµœâµ</h3>
                        <div class="question-review">
                            ${this.questions.map((q, i) => {
                                const isCorrect = q.result === 'Oui';
                                const userAnswerDisplay = q.userAnswer || "âµ‰âµ™âµ™âµâ´· âµ¡â´°â´½âµ“â´·";
                                return `
                                <div class="question-review-item ${isCorrect ? 'correct' : 'incorrect'}">
                                    <h4>
                                       ${i + 1}
                                        <i class="material-icons" style="vertical-align: middle;">${isCorrect ? 'check_circle' : 'highlight_off'}</i>
                                        ${isCorrect ? '' : ''}
                                    </h4>
                                    <p><b>â´°âµ™âµ‡âµ™âµ‰:</b> ${q.question}</p>
                                    <p><b>âµœâ´°âµâµ”â´°âµ”âµ“âµœ âµâ´½:</b> ${userAnswerDisplay}</p>
                                    ${!isCorrect ? `<p><b>âµœâ´°âµâµ”â´°âµ”âµ“âµœ:</b> ${q.correctAnswer}</p>` : ''}
                                     <p><b>â´°â´½âµ“â´·:</b> ${q.timeSpent ? `${q.timeSpent}s` : "0s"}</p>
                                </div>
                            `}).join('')}
                        </div>
                         <button class="restart-btn" onclick="location.reload()">
                            âµ™âµ™âµâµœâµ‰ â´·â´°âµ–
                        </button>
                    </div>
                `;
                // --- End of Modification ---
               downloadCSV(this.summaryData, this.playerName, avgTimeCorrect, this.score, this.questions.length);
            }
        }

        function downloadCSV(summaryData, playerName, avgTimeCorrect, score, totalQuestions) {
            if (!summaryData || summaryData.length === 0) return;

            function escapeCSV(field) {
                if (field == null) return '';
                const strField = String(field);
                 if (strField.includes(',') || strField.includes('\n') || strField.includes('"')) {
                     return `"${strField.replace(/"/g, '""')}"`;
                 }
                return strField;
            }

            const headers = ['â´°âµ™âµ‡âµ™âµ‰', 'â´°âµ™â´½â´½âµ‰âµ', 'âµœâ´°âµâµ”â´°âµ”âµ“âµœ', 'âµœâ´°âµâµ”â´°âµ”âµ“âµœ âµâ´½', 'â´°â´½âµ“â´·', 'â´°âµ™âµâµ“âµ'];
            const csvContent = [
                headers.join(','),
                ...summaryData.map((row, i) => [
                    i + 1,
                    escapeCSV(row.Question),
                    escapeCSV(row.CorrectAnswer),
                    escapeCSV(row.YourAnswer),
                    escapeCSV(row.TimeSpent),
                    escapeCSV(row.Result)
                ].join(','))
            ].join('\n');

            const percentage = totalQuestions > 0 ? ((score / totalQuestions) * 100).toFixed(1) : "0.0";
             const totalTime = summaryData.reduce((sum, row) => sum + parseFloat(row.TimeSpent || 0), 0);
            const avgTime = summaryData.length > 0 ? (totalTime / summaryData.length).toFixed(1) : "0.0";

            const summary = [
                '',
                'âµœâ´°â´³â´¹âµ¡âµ‰âµœ:',
                `â´°âµ™âµ™â´°âµ–,${escapeCSV(playerName)}`,
                `â´°âµœâµ‰â´³,"${score}/${totalQuestions}"`,
                `âµ‰âµ™â´½â´½âµ‰âµâµ,"${percentage}%"`,
                `â´°â´½âµ“â´·,"${avgTime}s"`,
                `â´°â´½âµ“â´· âµ âµ‰âµâµ‰â´·âµ‰âµœâµ,"${avgTimeCorrect}s"`
            ].join('\n');

            const fullCSV = [csvContent, summary].join('\n\n');
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + fullCSV], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const sanitizedPlayerName = playerName.replace(/[^a-z0-9_\-]/gi, '_');

            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, `${sanitizedPlayerName}_quiz_results.csv`);
            } else {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `${sanitizedPlayerName}_quiz_results.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
        }

        // Initialize the quiz
        new GeneralKnowledgeQuiz();
    </script>
</body>
</html>
